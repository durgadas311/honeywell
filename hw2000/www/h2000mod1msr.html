<HTML>
<HEAD>
<TITLE>MOD1 MSR Operating System Implementation</TITLE>
</HEAD>
<BODY>
<H2>MOD1 MSR Operating System Implementation</H2>

<P> An implementation/simulation of the MOD1 MSR (Mass Storage Resident)
operating system and programming environment is available. This provides
an easy way to manipulate files on mass storage media (Disk Packs).

<P>Features of "File Support C" and "Volume Preparation C" are implemented in
the menu "Disk Util". These allow initialization of a volume, mapping (listing)
of a volume, and allocation (create) and deallocation (delete) of files.
See information in <A HREF="h2000operation.html">Basic Operation</A>.

<P>Access to files (data) in programs is through the MOD1MSIO virtual macros
package, invoked (loaded) using the "MAC" assembler directive as described in
<A HREF="h2000easycoder.html">Easycoder Assembler Implementation</A>.
Apart from the non-standard virtual extension "MAC", the macros are
used as described in the MOD1 documentation, with the following exceptions:

<UL>
<LI>Only Sequential Organization files are supported.
<LI>Only single-volume files are supported.
<LI>LOCATE item-delivery mode is not Supported.
<LI>Password protection is not Supported.
<LI>The MUCA and MLCA macros are not supported.
<LI>Cylinder and general overflow is not Supported.
<LI>File date-stamping is not Supported.
<LI>File data type designation (print-image, etc) is not Supported.
<LI>Advisory EXITs are not supported (for example,
the EXIT to allow a program to extract *VOLDESCR* information during MSOPEN).
<LI>more...
</UL>

<P>Here is a sample program to read a file named "MYFILE01" and print it,
simplified for clarity.
<UL><PRE>
00010* MOD1 PROGRAM TO TEST READING DISK FILE
00020         PROG  MOD1T2
00030         ORG   1340
00040         ADMODE4
00050         MAC   MOD1MSIO
00060*
00070L        MIOC  A
00080*
00090C F1     MCA   A,
00100C        10    RECD2,DEVTAB,MOVE,RECD1
00110C        20    MYFILE01,
00120C        31    00,
00130C        40    ERROR,
00140C        43    DEXIT,
00150L        44    ERROR,
00160* ALL EXITS ARE TERMINAL, NEVER RETURN TO MIOC
00170*
00180  START  CAM   60
00190L        MSOPENF1,IN
00200L NEXT   MSGET F1,
00210         PDT   RECD1,12,02,01    PRINT RECORD
00220         PCB   *,12,02,00
00230         B     NEXT
00330*
00340L DONE   MSCLOSF1,
00350         PDT   FIN,10,02,01
00360         PCB   *,10,02,00
00370         B     (164)             MOD1 PROGRAM EXIT
00240*
00250  DEXITC DCW   #1B0
00260  DEXIT  SCR   ENDR,70
00270         BCE   DONE,DEXITC,01    EOF IS SOFT ERROR
00280         B     86                REST ARE FATAL
00290*
00300  ERRORC DCW   #1B0
00310  ERROR  SCR   ENDR,70
00320         B     86                ALL ARE FATAL
00390*
00400  ENDR   DSA   0
00410*
00420  DEVTAB RESV  0
00430         DCW   #3C040000         PCU, LUN, 00
00440 L       DCW   #1B0
00450*
00460   RECD1 RESV, 80                ITEM BUFFER
00470 L       DCW   #1A
00480*
00490   RECD2 RESV, 256               BLOCK BUFFER
00500 L       DCW   #1A
00510 L       DCW   #1A
00520 L       DCW   #1A
00530*
00540 F FIN   DC    @FINISHED @
00550*
00560         END   START
</PRE></UL>

<P>At card (line) 00050 is the modern extension to EasyCoder to load a macro library.
<P>At line 00070 is the initialization of MIOC, declaring instance "A".
Note that, in this implementation, all of MIOC/MPIOC is in a virtual runtime and
thus consumes no extra program memory, making most parameters to MIOC irrelevant.
<P>Beginning at line 00090 is the definition of the MCA for "MYFILE01".
<P>At line 00190 the file is opened for input-only. Note, any failures at this point
cause an EXIT call which is fatal/terminal.
<P>At line 00200 one item is read from the file. Note, a Data EXIT for EOF
will cause a graceful end to the program, checked on line 00270.
<P>In the case of a graceful end, the file is closed on line 00340.

</BODY>
</HTML>
